{% extends "base.html" %}
{% block content %}
<h1 class="mb-4">Search for Leagues</h1>
<form method="post" action="{{ url_for('matches') }}">
    {{ form.hidden_tag() }}
    <div class="form-group">
        {{ form.league.label(class="form-label") }}
        {{ form.league(class="form-control") }}
    </div>
    <div class="form-group">
        {{ form.gameweek.label(class="form-label") }}
        {{ form.gameweek(class="form-control") }}
    </div>
    <div class="form-group">
        {{ form.submit(class="btn btn-primary") }}
    </div>
</form>
{% if matches %}
<h2 class="mt-4">Matches</h2>
<table class="table table-striped">
    <thead>
        <tr>
            <th scope="col">Home Team</th>
            <th scope="col">Away Team</th>
            <th scope="col">Date</th>
            <th scope="col">Time</th>
            <th scope="col">Venue</th>
            <th scope="col">Status</th>
            <th scope="col">Score</th>
        </tr>
    </thead>
    <tbody>
        {% for match in matches %}
        <tr>
            <td><a href="{{ url_for('team_details', team_id=match.homeTeamId) }}">{{ match.homeTeam }}</a></td>
            <td><a href="{{ url_for('team_details', team_id=match.awayTeamId) }}">{{ match.awayTeam }}</a></td>
            <td class="match-date" data-utc="{{ match.utcDate }}"></td>
            <td class="match-time" data-utc="{{ match.utcDate }}"></td>
            <td>{{ match.venue }}</td>
            <td>{{ match.status }}</td>
            <td>{{ match.score.fullTime.homeTeam }} - {{ match.score.fullTime.awayTeam }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endif %}
{% if error %}
<div class="alert alert-danger">{{ error }}</div>
{% endif %}
<script>
document.addEventListener('DOMContentLoaded', function () {
    function formatDate(date) {
        const options = { day: '2-digit', month: '2-digit', year: 'numeric' };
        return date.toLocaleDateString(undefined, options);
    }

    function formatTime(date) {
        const options = { hour: '2-digit', minute: '2-digit', hour12: true };
        return date.toLocaleTimeString(undefined, options);
    }

    document.querySelectorAll('.match-date').forEach(function (element) {
        const utcDate = new Date(element.getAttribute('data-utc'));
        element.textContent = formatDate(utcDate);
    });

    document.querySelectorAll('.match-time').forEach(function (element) {
        const utcDate = new Date(element.getAttribute('data-utc'));
        element.textContent = formatTime(utcDate);
    });
});
</script>
{% endblock %}
